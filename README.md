# Инструкция для тестирования Альфа-Линк - 1С:Директбанк

## 1. Особенности работы с 1С:Директбанк

Технология Директбанк, позволяет отправлять документы напрямую в банк и получать их непосредственно из программы 1С

- Для запроса выписки не требуется подпись,
- При отправке платежа подпись обязательна,
- Версия формата документов = 2.2.2,
- Нет возможности настройки автоматического запроса выписки,
- Для подключения необходимо будет предоставить «документы для подключения Альфа-Линк» и единоразово оплатить его. Оплата отправки платежей (если требуется) производится отдельно, ежемесячно. 

Если вам необходимо только автоматически получать выписки из банка, то вы можете рассмотреть способ, описанный в [разделе](https://github.com/alfa-laboratory/alfalink-1c-directbank-via-api)

## 2. Настройка среды для тестирования через 1С

Для тестирования необходимо загрузить в 1С файл настроек и данные тестовых компаний. Все операции при тестировании проводятся на тестовых данных.

### 2.1. Скачивание архива со всеми необходимыми файлами

По [ссылке](https://github.com/alfa-laboratory/alfalink-1c-directbank-via-1c/archive/refs/heads/master.zip) можно скачать архив с необходимыми для тестирования файлами.

**Архив содержит:**

- Данную инструкцию по подключению (README.md и в формате pdf)

- Файл с тестовыми настройками directBank_settings.xml

- Файл сертификата для тестовой организации directBank_cert_psw_123456.pfx

- Папка с примерами документов в формате xml (examples)

### 2.2. Настройка и подключение

Для настройки технологии 1С:Директбанк необходимо файл настроек directBank_settings.xml из архива загрузить в программу 1С.

В разделе 1С "Настройка обмена с банками" есть команда "Загрузить из файла" (либо опция "Еще" → "Загрузить из файла").

Программа запросит выбор файла с диска и создаст настройку обмена (подробнее тут: [Инструкция по настройке 1С Директбанк](https://its.1c.ru/db/metod81#content:5375:hdoc@2fdb754e)).

Данные для авторизации: 

| Параметр | Значение |
| ------------- |-------------|
| Сервер | https://grampus-int.alfabank.ru/API/v1/directbank |
| Логин | directBank |
| Пароль | 123456 |

После загрузки настроек проверьте, что на странице «Настройки обмена с банком» для Альфа-банка указано:

- Идентификатор организации: 40702810701300009144
- Адрес сервера банка: https://grampus-int.alfabank.ru/API/v1/directbank
- Логин: directBank

![Пример](./examples/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B8%CC%86%D0%BA%D0%B8%20%D0%BE%D0%B1%D0%BC%D0%B5%D0%BD%D0%B0%20%D1%81%20%D0%B1%D0%B0%D0%BD%D0%BA%D0%BE%D0%BC%20%D0%BF%D0%BE%D1%81%D0%BB%D0%B5%20%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8%20%D1%84%D0%B0%D0%B8%CC%86%D0%BB%D0%B0.png "Настройки обмена с банком после загрузки файла")

![Пример](./examples/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B8%CC%86%D0%BA%D0%B8%20%D0%BE%D0%B1%D0%BC%D0%B5%D0%BD%D0%B0%20%D1%81%20%D0%B1%D0%B0%D0%BD%D0%BA%D0%BE%D0%BC%20%D0%BF%D0%BE%D1%81%D0%BB%D0%B5%20%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8%20%D1%84%D0%B0%D0%B8%CC%86%D0%BB%D0%B0%20-%202.png "Настройки обмена с банком после загрузки файла")

Если все поля заполнены верно, значит можно продолжать настройку. Иначе необходимо повторить загрузку файла настроек и проверить, нет ли ошибок при загрузке.

Если файл настроек не загружается корректно, необходимо обратиться в поддержку 1С.

### 2.3. Настройка тестовой компании 

Для тестирования используется тестовая компания, которую необходимо добавить в вашу 1С. Все операции при тестировании проводятся на тестовых данных. 

[Инструкция по добавлению тестовой компании](http://testdirectbank.1c.ru/docdirectbank.htm#_Toc10219664)

**Реквизиты компании:**

| Параметр | Значение |
| ------------- |-------------|
| Краткое наименование | ООО "Тест Директ Банк" |
| Полное наименование | Общество с ограниченной ответственностью "Тест Директ Банк" |
| ИНН | 0329156629 |
| КПП | 043360081 |
| Номер счета | 40702810701300009144 |
| Банк | АО "АЛЬФА-БАНК" |
| Корсчет банка | 30101810200000000593 |
| БИК банка | 044525593 |

**Реквизиты компании получателя (для тестирования платежей):**

| Параметр | Значение |
| ------------- |-------------|
| Краткое наименование | ООО "Тест Директ банк Получатель" |
| Полное наименование | Общество с ограниченной ответственностью "Тест Директ банк Получатель" |
| ИНН | 0329156630 |
| КПП | 770101999 |
| Номер счета | 40702810300000019796 |
| Банк | АО "АЛЬФА-БАНК" |
| Корсчет банка | 30101810200000000593 |
| БИК банка | 044525593 |

### 2.4. Сертификат для подписания платежа 

Перед отправкой на исполнение платеж необходимо подписать сертификатом квалифицированной подписи (файл directBank_cert_psw_123456.pfx).

Установите сертификат на свой компьютер. 
Пароль от сертификата: 123456

При подключении Альфа-линк необходимо предоставить в банк публичный (открытый) ключ квалифицированного сертификата (алгоритм подписи ГОСТ-2012) для подписания платежей.

Подходят сертификаты, которые используются, например, для сдачи отчетности в налоговую.

Сертификат должен быть выпущен на уполномоченное лицо, которое подключается к Альфа-линк.

Если сертификата нет, то его можно выпустить в любом [аккредитованном удостоверяющем центре](https://digital.gov.ru/ru/activity/govservices/certification_authority/).

Если не планируется направлять платежи из 1С, а только запрашивать выписку по счету, то сертификат предоставлять не нужно, в заявлении следует отметить роль "Оператор".

## 3. Справочная информация и поддержка 

В случае возникновения вопросов/проблем вы можете:

- Найти решение своего вопроса на [странице вопросов к документации](https://github.com/artik008/Alfa-link_1C_Directbank_via_1C/issues)

- Создать тикет на [странице документации](https://github.com/artik008/Alfa-link_1C_Directbank_via_1C/issues). Для этого нужно нажать на кнопку New issue, указать в заголовке краткое описание проблемы, а потом описать проблему полностью, при необходимости, приложив скриншоты.

- Отправить свой вопрос по почте на адрес:
    - AIShitik@alfabank.ru (Шитик Артём) 
    - в копию (обязательно):
        - AKopyltsova@alfabank.ru (Анна Копыльцова)
        - alfa-link@alfabank.ru 
